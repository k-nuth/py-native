#!/bin/bash

echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"

apt update
apt -y install python3-pip
apt -y install xz-utils
python3 -m pip install --upgrade pip

echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"

# python --version
python3 --version
# pyenv --version
# pyenv install --list

echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"

# sudo pip install --upgrade kthbuild
# sudo pip install --upgrade conan_package_tools
# sudo pip install --upgrade wheel
# sudo pip install --upgrade twine

pip3 install --upgrade kthbuild --user
pip3 install --upgrade conan_package_tools --user
pip3 install --upgrade wheel --user
pip3 install --upgrade twine --user
pip3 install auditwheel

echo $PATH
export PATH="$HOME/.local/bin/:$PATH"
echo $PATH

echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"

conan --version


echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"

cd $HOME
ls -la
cd .local
ls -la
cd bin
ls -la
# /home/fernando/.local/bin/conan

echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"

find / -name "conan"

echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"

python3 -c "import sysconfig; print(sysconfig.get_path('purelib'))"
cd /usr/lib/python3.5/site-packages
ls -la

echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"

conan --version
conan user

# echo "-----------------------------------------------------------------"
# echo "-----------------------------------------------------------------"
# echo "-----------------------------------------------------------------"
# echo "-----------------------------------------------------------------"
# echo "-----------------------------------------------------------------"

# cd
# cd .conan/profiles
# ls

echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"

conan profile list
conan profile new default --detect
conan profile list

# conan remote add kth_temp https://knuth.jfrog.io/artifactory/api/conan/knuth
conan config install https://github.com/k-nuth/ci-utils/raw/master/conan/config.zip

conan profile list

conan profile update settings.compiler.libcxx=libstdc++11 default

echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"
echo "-----------------------------------------------------------------"

cd /home/conan/project

# sudo conan install .
# sudo pip install  -e .
# sudo python setup.py sdist
conan install .
pip3 install  -e .
python3 setup.py sdist
python3 setup.py bdist_wheel


echo "*************************************************"
ls
echo "*************************************************"
auditwheel show dist/kth_py_native-0.1.0-cp35-cp35m-linux_x86_64.whl
echo "*************************************************"
auditwheel repair dist/kth_py_native-0.1.0-cp35-cp35m-linux_x86_64.whl
echo "*************************************************"
ls
echo "*************************************************"
auditwheel show dist/kth_py_native-0.1.0-cp35-cp35m-linux_x86_64.whl
echo "*************************************************"



# twine upload -u ${PYPI_USER_NAME} -p ${PYPI_PASSWORD} dist/*

# /bin/bash
